#
# Copyright (c) 2017-2019, Lawrence Livermore National Security, LLC and
# other Axom Project Developers. See the top-level COPYRIGHT file for details.
#
# SPDX-License-Identifier: (BSD-3-Clause)
#

strategy:
  matrix:
    linux:
      imageName: 'ubuntu-16.04'
      CMAKE_EXTRA_FLAGS: '-DAXOM_ENABLE_SIDRE=Off'

pool:
  vmImage: $(imageName)

variables:
  DO_BUILD: 'yes'
  DO_TEST: 'yes'
  COMPILER: 'g++'

steps:
- checkout: self
  clean: boolean
  submodules: recursive
- script:  |
   docker run --rm --user='root' -v `pwd`:/home/axom axom/compilers:gcc-6 chown -R axom /home/axom
   docker run --rm  -v `pwd`:/home/axom/src -e COMPILER -e DO_BUILD -e DO_TEST -e CMAKE_EXTRA_FLAGS axom/compilers:gcc-6 ls
  condition: eq( variables['Agent.OS'], 'Linux')
  displayName: 'Linux (Docker) Build & Test'
- task: PublishTestResults@2
  inputs:
    testResultsFormat: 'cTest'
    testResultsFiles: '**/Test.xml'
